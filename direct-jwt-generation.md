#!/bin/bash

# Script to generate JWT tokens directly for CMS integration
# This bypasses the API endpoint and generates tokens directly in the application

echo "=============================================="
echo "DIRECT JWT TOKEN GENERATION FOR CMS USERS"
echo "=============================================="

echo "Make sure your Plasmic server is running, then use this Node.js script:"
echo ""

echo "const { generateUserJwtToken } = require('./platform/wab/src/wab/server/auth/jwt-auth');"
echo ""
echo "// Generate token for your CMS user"
echo "const token = generateUserJwtToken("
echo "  'USER_ID_FROM_YOUR_CMS', // The user ID from your CMS"
echo "  'user@example.com',     // The user's email"
echo "  'First Name',           // First name (optional)"
echo "  'Last Name'             // Last name (optional)"
echo ");"
echo ""
echo "console.log('JWT Token:', token);"
echo "console.log('Embed URL: http://localhost:3003?token=' + token);"
echo ""
echo "=============================================="
echo "FROM YOUR CMS:"
echo "=============================================="
echo "# In your CMS backend, after a user authenticates:"
echo ""
echo "const userId = req.user.id; // From your CMS authentication"
echo "const userEmail = req.user.email;"
echo "const userFirstName = req.user.firstName;"
echo "const userLastName = req.user.lastName;"
echo ""
echo "// Call your internal method to generate the token"
echo "const jwtToken = generatePlasmicToken(userId, userEmail, userFirstName, userLastName);"
echo "const plasmicUrl = \`http://localhost:3003?token=\${jwtToken}\`;"
echo ""
echo "// Redirect user or embed in web view"
echo "res.redirect(plasmicUrl);"
echo ""
echo "# For embedding in web view:"
echo "# <iframe src=\"\${plasmicUrl}\" width=\"100%\" height=\"800px\" frameborder=\"0\"></iframe>"
echo "=============================================="